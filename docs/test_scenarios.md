# テストシナリオ仕様書

## 1. 概要

本ドキュメントは、AI主導型卓球パフォーマンス最大化システムのテストシナリオを定義する。

### 1.1 テスト対象

| モジュール | ファイル | 機能 |
|:---|:---|:---|
| LLM Analyzer | `src/analysis/llm_analyzer.py` | Gemini APIによる動画分析 |
| Prompts | `src/analysis/prompts.py` | プロンプトテンプレート |
| Report Generator | `src/output/report_generator.py` | レポート生成 |
| Main CLI | `src/main.py` | コマンドラインインターフェース |

### 1.2 テストレベル

| レベル | 目的 |
|:---|:---|
| 単体テスト | 各モジュールの個別機能の検証 |
| 統合テスト | モジュール間の連携の検証 |
| E2Eテスト | 動画入力からレポート出力までの一連の流れの検証 |

---

## 2. 単体テスト

### 2.1 LLM Analyzer モジュール

#### TC-001: 初期化テスト
| 項目 | 内容 |
|:---|:---|
| テストID | TC-001 |
| テスト名 | LLMAnalyzerの初期化 |
| 前提条件 | OPENAI_API_KEY環境変数が設定されている |
| 入力 | なし |
| 期待結果 | LLMAnalyzerインスタンスが正常に生成される |
| 優先度 | 高 |

#### TC-002: 動画ファイル存在チェック
| 項目 | 内容 |
|:---|:---|
| テストID | TC-002 |
| テスト名 | 存在しない動画ファイルの処理 |
| 前提条件 | なし |
| 入力 | 存在しないファイルパス |
| 期待結果 | FileNotFoundError例外が発生 |
| 優先度 | 高 |

#### TC-003: 動画分析の実行
| 項目 | 内容 |
|:---|:---|
| テストID | TC-003 |
| テスト名 | 動画分析の正常実行 |
| 前提条件 | 有効な動画ファイルが存在する |
| 入力 | 動画ファイルパス |
| 期待結果 | JSON形式の分析結果が返される |
| 優先度 | 高 |

#### TC-004: 分析結果のスキーマ検証
| 項目 | 内容 |
|:---|:---|
| テストID | TC-004 |
| テスト名 | 分析結果に必須フィールドが含まれる |
| 前提条件 | 分析が正常に完了している |
| 入力 | 分析結果JSON |
| 期待結果 | 「基本情報」「技術分析」「戦術分析」「強み」「改善点」が含まれる |
| 優先度 | 高 |

#### TC-005: 戦略生成の実行
| 項目 | 内容 |
|:---|:---|
| テストID | TC-005 |
| テスト名 | 戦略生成の正常実行 |
| 前提条件 | 分析結果が存在する |
| 入力 | 分析結果JSON、対戦相手情報（オプション） |
| 期待結果 | サーブ戦略、レシーブ戦略、ラリー戦略を含むJSONが返される |
| 優先度 | 高 |

#### TC-006: 練習計画生成の実行
| 項目 | 内容 |
|:---|:---|
| テストID | TC-006 |
| テスト名 | 練習計画生成の正常実行 |
| 前提条件 | 分析結果が存在する |
| 入力 | 分析結果JSON |
| 期待結果 | 優先課題、週間計画、ドリル、目標設定を含むJSONが返される |
| 優先度 | 高 |

### 2.2 Prompts モジュール

#### TC-007: プロンプトテンプレートの存在確認
| 項目 | 内容 |
|:---|:---|
| テストID | TC-007 |
| テスト名 | 必須プロンプトテンプレートの存在 |
| 前提条件 | なし |
| 入力 | なし |
| 期待結果 | ANALYSIS_PROMPT, STRATEGY_PROMPT, PRACTICE_PROMPTが定義されている |
| 優先度 | 中 |

#### TC-008: プロンプト変数の置換
| 項目 | 内容 |
|:---|:---|
| テストID | TC-008 |
| テスト名 | プロンプト内の変数が正しく置換される |
| 前提条件 | なし |
| 入力 | テンプレートと変数辞書 |
| 期待結果 | {player_name}等の変数が実際の値に置換される |
| 優先度 | 中 |

### 2.3 Report Generator モジュール

#### TC-009: Markdownレポート生成
| 項目 | 内容 |
|:---|:---|
| テストID | TC-009 |
| テスト名 | 分析結果からMarkdownレポートを生成 |
| 前提条件 | 有効な分析結果JSONが存在する |
| 入力 | 分析結果JSON |
| 期待結果 | 整形されたMarkdownファイルが生成される |
| 優先度 | 中 |

#### TC-010: 戦略シート生成
| 項目 | 内容 |
|:---|:---|
| テストID | TC-010 |
| テスト名 | 戦略結果からA4戦略シートを生成 |
| 前提条件 | 有効な戦略結果JSONが存在する |
| 入力 | 戦略結果JSON |
| 期待結果 | A4一枚に収まる戦略シートMarkdownが生成される |
| 優先度 | 中 |

#### TC-011: 練習計画書生成
| 項目 | 内容 |
|:---|:---|
| テストID | TC-011 |
| テスト名 | 練習計画結果から練習計画書を生成 |
| 前提条件 | 有効な練習計画結果JSONが存在する |
| 入力 | 練習計画結果JSON |
| 期待結果 | 週間計画とドリルを含む練習計画書Markdownが生成される |
| 優先度 | 中 |

---

## 3. 統合テスト

### 3.1 分析→戦略生成フロー

#### TC-101: 分析結果を戦略生成に渡す
| 項目 | 内容 |
|:---|:---|
| テストID | TC-101 |
| テスト名 | 分析結果を入力として戦略を生成 |
| 前提条件 | 動画ファイルが存在する |
| 入力 | 動画ファイルパス |
| 期待結果 | 分析→戦略生成が連続して実行され、整合性のある結果が得られる |
| 優先度 | 高 |

### 3.2 分析→練習計画生成フロー

#### TC-102: 分析結果を練習計画生成に渡す
| 項目 | 内容 |
|:---|:---|
| テストID | TC-102 |
| テスト名 | 分析結果を入力として練習計画を生成 |
| 前提条件 | 動画ファイルが存在する |
| 入力 | 動画ファイルパス |
| 期待結果 | 分析→練習計画生成が連続して実行され、課題に対応した練習が提案される |
| 優先度 | 高 |

### 3.3 フル分析フロー

#### TC-103: 全機能の連続実行
| 項目 | 内容 |
|:---|:---|
| テストID | TC-103 |
| テスト名 | 分析→戦略→練習計画の一括実行 |
| 前提条件 | 動画ファイルが存在する |
| 入力 | 動画ファイルパス |
| 期待結果 | 3つの出力（分析、戦略、練習計画）が整合性を持って生成される |
| 優先度 | 高 |

---

## 4. E2Eテスト

### 4.1 CLIテスト

#### TC-201: analyzeコマンドの実行
| 項目 | 内容 |
|:---|:---|
| テストID | TC-201 |
| テスト名 | CLIからanalyzeコマンドを実行 |
| 前提条件 | 動画ファイルが存在する |
| 入力 | `python main.py analyze --video <path>` |
| 期待結果 | 分析結果JSONが指定ディレクトリに保存される |
| 優先度 | 高 |

#### TC-202: strategyコマンドの実行
| 項目 | 内容 |
|:---|:---|
| テストID | TC-202 |
| テスト名 | CLIからstrategyコマンドを実行 |
| 前提条件 | 分析結果JSONが存在する |
| 入力 | `python main.py strategy --analysis <path>` |
| 期待結果 | 戦略結果JSONが指定ディレクトリに保存される |
| 優先度 | 高 |

#### TC-203: practiceコマンドの実行
| 項目 | 内容 |
|:---|:---|
| テストID | TC-203 |
| テスト名 | CLIからpracticeコマンドを実行 |
| 前提条件 | 分析結果JSONが存在する |
| 入力 | `python main.py practice --analysis <path>` |
| 期待結果 | 練習計画結果JSONが指定ディレクトリに保存される |
| 優先度 | 高 |

#### TC-204: fullコマンドの実行
| 項目 | 内容 |
|:---|:---|
| テストID | TC-204 |
| テスト名 | CLIからfullコマンドを実行 |
| 前提条件 | 動画ファイルが存在する |
| 入力 | `python main.py full --video <path>` |
| 期待結果 | 分析、戦略、練習計画の3つのJSONが保存される |
| 優先度 | 高 |

### 4.2 エラーハンドリングテスト

#### TC-205: 無効な動画ファイル
| 項目 | 内容 |
|:---|:---|
| テストID | TC-205 |
| テスト名 | 無効な動画ファイルを指定した場合のエラー処理 |
| 前提条件 | なし |
| 入力 | 存在しないファイルパス |
| 期待結果 | 適切なエラーメッセージが表示され、プログラムが正常終了する |
| 優先度 | 中 |

#### TC-206: API接続エラー
| 項目 | 内容 |
|:---|:---|
| テストID | TC-206 |
| テスト名 | API接続エラー時の処理 |
| 前提条件 | 無効なAPIキーを設定 |
| 入力 | 有効な動画ファイルパス |
| 期待結果 | 適切なエラーメッセージが表示され、リトライまたは正常終了する |
| 優先度 | 中 |

#### TC-207: 出力ディレクトリ権限エラー
| 項目 | 内容 |
|:---|:---|
| テストID | TC-207 |
| テスト名 | 書き込み権限のないディレクトリへの出力 |
| 前提条件 | 書き込み権限のないディレクトリを指定 |
| 入力 | 動画ファイルパス、出力ディレクトリ |
| 期待結果 | 適切なエラーメッセージが表示される |
| 優先度 | 低 |

---

## 5. 品質基準

### 5.1 合格基準

| 項目 | 基準 |
|:---|:---|
| 単体テスト合格率 | 100% |
| 統合テスト合格率 | 100% |
| E2Eテスト合格率 | 95%以上 |
| コードカバレッジ | 80%以上 |

### 5.2 テスト環境

| 項目 | 仕様 |
|:---|:---|
| OS | Ubuntu 22.04 |
| Python | 3.11 |
| テストフレームワーク | pytest |
| モック | unittest.mock |

---

## 6. テスト実行手順

### 6.1 単体テスト

```bash
cd ~/tt-performance-system
pip install pytest pytest-cov
pytest tests/unit/ -v --cov=src
```

### 6.2 統合テスト

```bash
pytest tests/integration/ -v
```

### 6.3 E2Eテスト

```bash
pytest tests/e2e/ -v
```

### 6.4 全テスト実行

```bash
pytest tests/ -v --cov=src --cov-report=html
```

---

## 7. 変更履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|:---|:---|:---|:---|
| 2026-01-03 | 1.0 | 初版作成 | AI |
